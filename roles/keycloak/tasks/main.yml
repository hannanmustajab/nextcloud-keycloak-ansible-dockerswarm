---

# - name: Pull the Keycloak image
#   docker_image:
#     name: quay.io/keycloak/keycloak:20.0.1
#     source: pull

- name: Stop keycloak service
  docker_container:
    name: keycloak
    image: quay.io/keycloak/keycloak:20.0.1
    state: absent
  # when: inventory_hostname is in groups['swarm-managers']


- name: Create a keycloak service
  docker_container:
    name: keycloak
    image: quay.io/keycloak/keycloak:20.0.1
    state: present
    ports:
     - "8080:8080"
    env:
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
    command: start-dev
  # when: inventory_hostname is in groups['swarm-managers']


# - name: Deploy the service
#   docker_swarm_service:
#     name: postgres
#     state: present
#   when: inventory_hostname is in groups['swarm-managers']
